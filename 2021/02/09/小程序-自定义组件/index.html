<!DOCTYPE html>
<html lang=zh>
<head>
    <!-- so meta -->
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="HandheldFriendly" content="True">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1" />
    <meta name="description" content="小程序-自定义组件组件模板和样式1.组件模板 新建components文件夹存放我们要自定义的组件 在components下新建文件夹index,然后在index文件右击选择新建Component，输入index。这样就创建了index组件，生成对应的组件模板  组件模板中可以提供一个 &lt;slot&gt; 节点，用于承载组件引用时提供的子节点。 123456789101112&lt;view">
<meta property="og:type" content="article">
<meta property="og:title" content="小程序-自定义组件">
<meta property="og:url" content="http://example.com/2021/02/09/%E5%B0%8F%E7%A8%8B%E5%BA%8F-%E8%87%AA%E5%AE%9A%E4%B9%89%E7%BB%84%E4%BB%B6/index.html">
<meta property="og:site_name" content="aking-blog">
<meta property="og:description" content="小程序-自定义组件组件模板和样式1.组件模板 新建components文件夹存放我们要自定义的组件 在components下新建文件夹index,然后在index文件右击选择新建Component，输入index。这样就创建了index组件，生成对应的组件模板  组件模板中可以提供一个 &lt;slot&gt; 节点，用于承载组件引用时提供的子节点。 123456789101112&lt;view">
<meta property="og:locale" content="zh_CN">
<meta property="article:published_time" content="2021-02-09T15:28:11.452Z">
<meta property="article:modified_time" content="2021-02-09T15:28:11.452Z">
<meta property="article:author" content="Aking">
<meta name="twitter:card" content="summary">
    
    
      
        
          <link rel="shortcut icon" href="/images/favicon.ico">
        
      
      
        
          <link rel="icon" type="image/png" href="/images/favicon-192x192.png" sizes="192x192">
        
      
      
        
          <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon.png">
        
      
    
    <!-- title -->
    <title>小程序-自定义组件</title>
    <!-- styles -->
    
<link rel="stylesheet" href="/css/style.css">

    <!-- persian styles -->
    
      
<link rel="stylesheet" href="/css/rtl.css">

    
    <!-- rss -->
    
    
<meta name="generator" content="Hexo 5.3.0"></head>

<body class="max-width mx-auto px3 ltr">
    
      <div id="header-post">
  <a id="menu-icon" href="#"><i class="fas fa-bars fa-lg"></i></a>
  <a id="menu-icon-tablet" href="#"><i class="fas fa-bars fa-lg"></i></a>
  <a id="top-icon-tablet" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');" style="display:none;"><i class="fas fa-chevron-up fa-lg"></i></a>
  <span id="menu">
    <span id="nav">
      <ul>
         
          <li><a href="/archives/">首页</a></li>
         
          <li><a href="/archives/">关于</a></li>
         
          <li><a href="/archives/">归档</a></li>
         
          <li><a href="/archives">项目</a></li>
        
      </ul>
    </span>
    <br/>
    <span id="actions">
      <ul>
        
        <li><a class="icon" href="/2021/02/09/%E8%AE%BE%E8%AE%A1%E7%A8%BF%E8%A7%84%E8%8C%83/"><i class="fas fa-chevron-left" aria-hidden="true" onmouseover="$('#i-prev').toggle();" onmouseout="$('#i-prev').toggle();"></i></a></li>
        
        
        <li><a class="icon" href="/2021/02/09/%E6%89%8B%E6%92%95%E4%BB%A3%E7%A0%81/"><i class="fas fa-chevron-right" aria-hidden="true" onmouseover="$('#i-next').toggle();" onmouseout="$('#i-next').toggle();"></i></a></li>
        
        <li><a class="icon" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');"><i class="fas fa-chevron-up" aria-hidden="true" onmouseover="$('#i-top').toggle();" onmouseout="$('#i-top').toggle();"></i></a></li>
        <li><a class="icon" href="#"><i class="fas fa-share-alt" aria-hidden="true" onmouseover="$('#i-share').toggle();" onmouseout="$('#i-share').toggle();" onclick="$('#share').toggle();return false;"></i></a></li>
      </ul>
      <span id="i-prev" class="info" style="display:none;">上一篇</span>
      <span id="i-next" class="info" style="display:none;">下一篇</span>
      <span id="i-top" class="info" style="display:none;">返回顶部</span>
      <span id="i-share" class="info" style="display:none;">分享文章</span>
    </span>
    <br/>
    <div id="share" style="display: none">
      <ul>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.facebook.com/sharer.php?u=http://example.com/2021/02/09/%E5%B0%8F%E7%A8%8B%E5%BA%8F-%E8%87%AA%E5%AE%9A%E4%B9%89%E7%BB%84%E4%BB%B6/"><i class="fab fa-facebook " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://twitter.com/share?url=http://example.com/2021/02/09/%E5%B0%8F%E7%A8%8B%E5%BA%8F-%E8%87%AA%E5%AE%9A%E4%B9%89%E7%BB%84%E4%BB%B6/&text=小程序-自定义组件"><i class="fab fa-twitter " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.linkedin.com/shareArticle?url=http://example.com/2021/02/09/%E5%B0%8F%E7%A8%8B%E5%BA%8F-%E8%87%AA%E5%AE%9A%E4%B9%89%E7%BB%84%E4%BB%B6/&title=小程序-自定义组件"><i class="fab fa-linkedin " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://pinterest.com/pin/create/bookmarklet/?url=http://example.com/2021/02/09/%E5%B0%8F%E7%A8%8B%E5%BA%8F-%E8%87%AA%E5%AE%9A%E4%B9%89%E7%BB%84%E4%BB%B6/&is_video=false&description=小程序-自定义组件"><i class="fab fa-pinterest " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="mailto:?subject=小程序-自定义组件&body=Check out this article: http://example.com/2021/02/09/%E5%B0%8F%E7%A8%8B%E5%BA%8F-%E8%87%AA%E5%AE%9A%E4%B9%89%E7%BB%84%E4%BB%B6/"><i class="fas fa-envelope " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://getpocket.com/save?url=http://example.com/2021/02/09/%E5%B0%8F%E7%A8%8B%E5%BA%8F-%E8%87%AA%E5%AE%9A%E4%B9%89%E7%BB%84%E4%BB%B6/&title=小程序-自定义组件"><i class="fab fa-get-pocket " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://reddit.com/submit?url=http://example.com/2021/02/09/%E5%B0%8F%E7%A8%8B%E5%BA%8F-%E8%87%AA%E5%AE%9A%E4%B9%89%E7%BB%84%E4%BB%B6/&title=小程序-自定义组件"><i class="fab fa-reddit " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.stumbleupon.com/submit?url=http://example.com/2021/02/09/%E5%B0%8F%E7%A8%8B%E5%BA%8F-%E8%87%AA%E5%AE%9A%E4%B9%89%E7%BB%84%E4%BB%B6/&title=小程序-自定义组件"><i class="fab fa-stumbleupon " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://digg.com/submit?url=http://example.com/2021/02/09/%E5%B0%8F%E7%A8%8B%E5%BA%8F-%E8%87%AA%E5%AE%9A%E4%B9%89%E7%BB%84%E4%BB%B6/&title=小程序-自定义组件"><i class="fab fa-digg " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.tumblr.com/share/link?url=http://example.com/2021/02/09/%E5%B0%8F%E7%A8%8B%E5%BA%8F-%E8%87%AA%E5%AE%9A%E4%B9%89%E7%BB%84%E4%BB%B6/&name=小程序-自定义组件&description="><i class="fab fa-tumblr " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://news.ycombinator.com/submitlink?u=http://example.com/2021/02/09/%E5%B0%8F%E7%A8%8B%E5%BA%8F-%E8%87%AA%E5%AE%9A%E4%B9%89%E7%BB%84%E4%BB%B6/&t=小程序-自定义组件"><i class="fab fa-hacker-news " aria-hidden="true"></i></a></li>
</ul>

    </div>
    <div id="toc">
      <ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%B0%8F%E7%A8%8B%E5%BA%8F-%E8%87%AA%E5%AE%9A%E4%B9%89%E7%BB%84%E4%BB%B6"><span class="toc-number">1.</span> <span class="toc-text">小程序-自定义组件</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%BB%84%E4%BB%B6%E6%A8%A1%E6%9D%BF%E5%92%8C%E6%A0%B7%E5%BC%8F"><span class="toc-number">1.1.</span> <span class="toc-text">组件模板和样式</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1-%E7%BB%84%E4%BB%B6%E6%A8%A1%E6%9D%BF"><span class="toc-number">1.1.1.</span> <span class="toc-text">1.组件模板</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-%E7%BB%84%E4%BB%B6wxml%E7%9A%84slot"><span class="toc-number">1.1.2.</span> <span class="toc-text">2.组件wxml的slot</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-%E7%BB%84%E4%BB%B6%E6%A0%B7%E5%BC%8F"><span class="toc-number">1.1.3.</span> <span class="toc-text">3.组件样式</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#4-%E7%BB%84%E4%BB%B6%E6%A0%B7%E5%BC%8F%E9%9A%94%E7%A6%BB"><span class="toc-number">1.1.4.</span> <span class="toc-text">4.组件样式隔离</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%A4%96%E9%83%A8%E6%A0%B7%E5%BC%8F%E7%B1%BB"><span class="toc-number">1.1.5.</span> <span class="toc-text">外部样式类</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#6-%E8%99%9A%E6%8B%9F%E5%8C%96%E7%BB%84%E4%BB%B6%E8%8A%82%E7%82%B9"><span class="toc-number">1.1.6.</span> <span class="toc-text">6. 虚拟化组件节点</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Component-%E6%9E%84%E9%80%A0%E5%99%A8"><span class="toc-number">1.2.</span> <span class="toc-text">Component 构造器</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1-Component-%E6%9E%84%E9%80%A0%E5%99%A8"><span class="toc-number">1.2.1.</span> <span class="toc-text">1.Component 构造器</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-%E4%BD%BF%E7%94%A8-Component-%E6%9E%84%E9%80%A0%E5%99%A8%E6%9E%84%E9%80%A0%E9%A1%B5%E9%9D%A2"><span class="toc-number">1.2.2.</span> <span class="toc-text">2.使用 Component 构造器构造页面</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%BB%84%E4%BB%B6%E9%97%B4%E9%80%9A%E4%BF%A1%E4%B8%8E%E4%BA%8B%E4%BB%B6"><span class="toc-number">1.3.</span> <span class="toc-text">组件间通信与事件</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1-%E7%BB%84%E4%BB%B6%E9%97%B4%E9%80%9A%E4%BF%A1"><span class="toc-number">1.3.1.</span> <span class="toc-text">1.组件间通信</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E7%88%B6%E4%BC%A0%E5%AD%90"><span class="toc-number">1.3.1.1.</span> <span class="toc-text">父传子</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%AD%90%E4%BC%A0%E7%88%B6"><span class="toc-number">1.3.1.2.</span> <span class="toc-text">子传父</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%8E%B7%E5%8F%96%E7%BB%84%E4%BB%B6%E5%AE%9E%E4%BE%8B"><span class="toc-number">1.3.2.</span> <span class="toc-text">获取组件实例</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%BB%84%E4%BB%B6%E7%94%9F%E5%91%BD%E5%91%A8%E6%9C%9F"><span class="toc-number">1.4.</span> <span class="toc-text">组件生命周期</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1-%E7%BB%84%E4%BB%B6%E7%94%9F%E5%91%BD%E5%91%A8%E6%9C%9F"><span class="toc-number">1.4.1.</span> <span class="toc-text">1.组件生命周期</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-%E5%AE%9A%E4%B9%89%E7%94%9F%E5%91%BD%E5%91%A8%E6%9C%9F%E6%96%B9%E6%B3%95"><span class="toc-number">1.4.2.</span> <span class="toc-text">2.定义生命周期方法</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-%E7%BB%84%E4%BB%B6%E6%89%80%E5%9C%A8%E9%A1%B5%E9%9D%A2%E7%9A%84%E7%94%9F%E5%91%BD%E5%91%A8%E6%9C%9F"><span class="toc-number">1.4.3.</span> <span class="toc-text">3.组件所在页面的生命周期</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#behaviors"><span class="toc-number">1.5.</span> <span class="toc-text">behaviors</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%BB%84%E4%BB%B6%E9%97%B4%E5%85%B3%E7%B3%BB"><span class="toc-number">1.6.</span> <span class="toc-text">组件间关系</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%95%B0%E6%8D%AE%E7%9B%91%E5%90%AC%E5%99%A8"><span class="toc-number">1.7.</span> <span class="toc-text">数据监听器</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1-%E4%BD%BF%E7%94%A8%E6%95%B0%E6%8D%AE%E7%9B%91%E5%90%AC%E5%99%A8"><span class="toc-number">1.7.1.</span> <span class="toc-text">1.使用数据监听器</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-%E7%9B%91%E5%90%AC%E5%AD%97%E6%AE%B5%E8%AF%AD%E6%B3%95"><span class="toc-number">1.7.2.</span> <span class="toc-text">2.监听字段语法</span></a></li></ol></li></ol></li></ol>
    </div>
  </span>
</div>

    
    <div class="content index py4">
        
        <article class="post" itemscope itemtype="http://schema.org/BlogPosting">
  <header>
    
    <h1 class="posttitle" itemprop="name headline">
        小程序-自定义组件
    </h1>



    <div class="meta">
      <span class="author" itemprop="author" itemscope itemtype="http://schema.org/Person">
        <span itemprop="name">Aking</span>
      </span>
      
    <div class="postdate">
      
        <time datetime="2021-02-09T15:28:11.452Z" itemprop="datePublished">2021-02-09</time>
        
      
    </div>


      

      

    </div>
  </header>
  

  <div class="content" itemprop="articleBody">
    <h2 id="小程序-自定义组件"><a href="#小程序-自定义组件" class="headerlink" title="小程序-自定义组件"></a>小程序-自定义组件</h2><h3 id="组件模板和样式"><a href="#组件模板和样式" class="headerlink" title="组件模板和样式"></a>组件模板和样式</h3><h4 id="1-组件模板"><a href="#1-组件模板" class="headerlink" title="1.组件模板"></a>1.组件模板</h4><ul>
<li>新建components文件夹存放我们要自定义的组件</li>
<li>在components下新建文件夹index,然后在index文件右击选择新建Component，输入index。这样就创建了index组件，生成对应的组件模板</li>
</ul>
<p>组件模板中可以提供一个 <code>&lt;slot&gt;</code> 节点，用于承载组件引用时提供的子节点。</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">&quot;wrapper&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">view</span>&gt;</span>这里是组件的内部节点<span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">slot</span>&gt;</span><span class="tag">&lt;/<span class="name">slot</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- 引用组件的页面模板 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">view</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">index</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 这部分内容将被放置在组件 &lt;slot&gt; 的位置上 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">view</span>&gt;</span>这里是插入到组件slot中的内容<span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">index</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br></pre></td></tr></table></figure>
<ul>
<li>在引入组件的页面模板的json文件显式定义，否则会被当作一个无意义的节点</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// home页面--home.json</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;usingComponents&quot;</span>: &#123;</span><br><span class="line">    <span class="string">&quot;index&quot;</span>: <span class="string">&quot;/components/index/index&quot;</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="2-组件wxml的slot"><a href="#2-组件wxml的slot" class="headerlink" title="2.组件wxml的slot"></a>2.组件wxml的slot</h4><p>默认情况下，一个组件的 wxml 中只能有一个 slot 。需要使用多 slot 时，可以在组件 js 中声明启用。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">Component(&#123;</span><br><span class="line">  options: &#123;</span><br><span class="line">    multipleSlots: <span class="literal">true</span> <span class="comment">// 在组件定义时的选项中启用多slot支持</span></span><br><span class="line">  &#125;,</span><br><span class="line">  properties: &#123; <span class="comment">/* ... */</span> &#125;,</span><br><span class="line">  methods: &#123; <span class="comment">/* ... */</span> &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<p>此时，可以在index这个组件的 wxml 中使用多个 slot ，以不同的 <code>name</code> 来区分。</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 组件模板 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">&quot;wrapper&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">slot</span> <span class="attr">name</span>=<span class="string">&quot;before&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">slot</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">view</span>&gt;</span>这里是组件的内部细节<span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">slot</span> <span class="attr">name</span>=<span class="string">&quot;after&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">slot</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>使用时，用 <code>slot</code> 属性来将节点插入到不同的 slot 上。</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 引用组件的页面模板 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">view</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">index</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 这部分内容将被放置在组件 &lt;slot name=&quot;before&quot;&gt; 的位置上 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">view</span> <span class="attr">slot</span>=<span class="string">&quot;before&quot;</span>&gt;</span>这里是插入到组件slot name=&quot;before&quot;中的内容<span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 这部分内容将被放置在组件 &lt;slot name=&quot;after&quot;&gt; 的位置上 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">view</span> <span class="attr">slot</span>=<span class="string">&quot;after&quot;</span>&gt;</span>这里是插入到组件slot name=&quot;after&quot;中的内容<span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">index</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h4 id="3-组件样式"><a href="#3-组件样式" class="headerlink" title="3.组件样式"></a>3.组件样式</h4><p>组件对应 <code>wxss</code> 文件的样式，只对组件wxml内的节点生效。编写组件样式时，需要注意以下几点：</p>
<ul>
<li>组件和引用组件的页面不能使用id选择器（<code>#a</code>）、属性选择器（<code>[a]</code>）和标签名选择器，请改用class选择器。</li>
<li>继承样式，如 <code>font</code> 、 <code>color</code> ，会从组件外继承到组件内。</li>
<li>除继承样式外， <code>app.wxss</code> 中的样式、组件所在页面的的样式<strong>对自定义组件无效</strong>（除非更改组件样式隔离选项）。</li>
</ul>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-id">#a</span> &#123; &#125; <span class="comment">/* 在组件中不能使用 */</span></span><br><span class="line"><span class="selector-attr">[a]</span> &#123; &#125; <span class="comment">/* 在组件中不能使用 */</span></span><br><span class="line"><span class="selector-tag">button</span> &#123; &#125; <span class="comment">/* 在组件中不能使用 */</span></span><br><span class="line"><span class="selector-class">.a</span> &gt; <span class="selector-class">.b</span> &#123; &#125; <span class="comment">/* 除非 .a 是 view 组件节点，否则不一定会生效 */</span></span><br></pre></td></tr></table></figure>
<h4 id="4-组件样式隔离"><a href="#4-组件样式隔离" class="headerlink" title="4.组件样式隔离"></a>4.组件样式隔离</h4><p>默认情况下，自定义组件的样式只受到自定义组件 wxss 的影响。</p>
<p>除非以下两种情况：</p>
<ul>
<li><code>app.wxss</code> 或页面的 <code>wxss</code> 中使用了标签名选择器（或一些其他特殊选择器）来直接指定样式，这些选择器会影响到页面和全部组件。通常情况下这是不推荐的做法。</li>
<li>指定特殊的样式隔离选项 <code>styleIsolation</code> 。</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">Component(&#123;</span><br><span class="line">  options: &#123;</span><br><span class="line">    styleIsolation: <span class="string">&#x27;isolated&#x27;</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<p>styleIsolation它支持以下取值：</p>
<ul>
<li><code>isolated</code> 表示启用样式隔离，在自定义组件内外，使用 class 指定的样式将不会相互影响（一般情况下的默认值）；</li>
<li><code>apply-shared</code> 表示页面 wxss 样式将影响到自定义组件，但自定义组件 wxss 中指定的样式不会影响页面；</li>
<li><code>shared</code> 表示页面 wxss 样式将影响到自定义组件，自定义组件 wxss 中指定的样式也会影响页面和其他设置了 <code>apply-shared</code> 或 <code>shared</code> 的自定义组件。（这个选项在插件中不可用。）</li>
</ul>
<p>使用后两者时，请务必注意组件间样式的相互影响。</p>
<p>注意：</p>
<ul>
<li><p>apply-shared  但想在自己定义的组件中使用全局的样式是设置，自定义组件里的样式不会影响到页面组件，但是页面组件的样式会影响自定义组件样式</p>
</li>
<li><p>还有一种写法是 addGlobalClass: true 这种写法和设置styleIsolation：‘apply-shared’ 一样</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">Component(&#123;</span><br><span class="line">  options: &#123;</span><br><span class="line">    addGlobalClass: <span class="literal">true</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">Component(&#123;</span><br><span class="line">  options: &#123;</span><br><span class="line">    styleIsolation: <span class="string">&#x27;apply-shared&#x27;</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">// 设置了<span class="selector-tag">apply-shared</span> 的自定义组件</span><br><span class="line">// 可以使用<span class="selector-tag">app</span><span class="selector-class">.wxss</span> 和<span class="selector-tag">home</span><span class="selector-class">.wxss</span>的样式</span><br><span class="line">// 也就是说可以使用外部的所有样式，但是自己的内部的样式，外部是不可以使用的</span><br></pre></td></tr></table></figure></li>
<li><p><code>shared</code> 这个的话就是相互影响了</p>
</li>
</ul>
<h4 id="外部样式类"><a href="#外部样式类" class="headerlink" title="外部样式类"></a>外部样式类</h4><p>有时，组件希望接受外部传入的样式类。此时可以在 <code>Component</code> 中用 <code>externalClasses</code> 定义段定义若干个外部样式类。</p>
<p>这个特性可以用于实现类似于 <code>view</code> 组件的 <code>hover-class</code> 属性：页面可以提供一个样式类，赋予 <code>view</code> 的 <code>hover-class</code> ，这个样式类本身写在页面中而非 <code>view</code> 组件的实现中。</p>
<p><strong>注意：在同一个节点上使用普通样式类和外部样式类时，两个类的优先级是未定义的，因此最好避免这种情况。</strong></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* 组件 custom-component.js */</span></span><br><span class="line">Component(&#123;</span><br><span class="line">  externalClasses: [<span class="string">&#x27;my-class&#x27;</span>]</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">&lt;!-- 组件 custom-component.wxml --&gt;</span><br><span class="line">&lt;custom-component <span class="class"><span class="keyword">class</span></span>=<span class="string">&quot;my-class&quot;</span>&gt;这段文本的颜色由组件外的 <span class="class"><span class="keyword">class</span> 决定&lt;/<span class="title">custom</span>-<span class="title">component</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>这样，组件的使用者可以指定这个样式类对应的 class ，就像使用普通属性一样。</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 页面的 WXML --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">custom-component</span> <span class="attr">my-class</span>=<span class="string">&quot;red-text&quot;</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">custom-component</span> <span class="attr">my-class</span>=<span class="string">&quot;large-text&quot;</span> /&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- 以下写法需要基础库版本 2.7.1 以上 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">custom-component</span> <span class="attr">my-class</span>=<span class="string">&quot;red-text large-text&quot;</span> /&gt;</span></span><br><span class="line">.red-text &#123;</span><br><span class="line">  color: red;</span><br><span class="line">&#125;</span><br><span class="line">.large-text &#123;</span><br><span class="line">  font-size: 1.5em;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="6-虚拟化组件节点"><a href="#6-虚拟化组件节点" class="headerlink" title="6. 虚拟化组件节点"></a>6. 虚拟化组件节点</h4><p>默认情况下，自定义组件本身的那个节点是一个“普通”的节点，使用时可以在这个节点上设置 <code>class</code> <code>style</code> 、动画、 flex 布局等，就如同普通的 view 组件节点一样。</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 页面的 WXML --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">view</span> <span class="attr">style</span>=<span class="string">&quot;display: flex&quot;</span>&gt;</span></span><br><span class="line">  <span class="comment">&lt;!-- 默认情况下，这是一个普通的节点 --&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">custom-component</span> <span class="attr">style</span>=<span class="string">&quot;color: blue; flex: 1&quot;</span>&gt;</span>蓝色、满宽的<span class="tag">&lt;/<span class="name">custom-component</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>但有些时候，自定义组件并不希望这个节点本身可以设置样式、响应 flex 布局等，而是希望自定义组件内部的第一层节点能够响应 flex 布局或者样式由自定义组件本身完全决定。</p>
<p>这种情况下，可以将这个自定义组件设置为“虚拟的”：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">Component(&#123;</span><br><span class="line">  options: &#123;</span><br><span class="line">    virtualHost: <span class="literal">true</span></span><br><span class="line">  &#125;,</span><br><span class="line">  properties: &#123;</span><br><span class="line">    style: &#123; <span class="comment">// 定义 style 属性可以拿到 style 属性上设置的值</span></span><br><span class="line">      type: <span class="built_in">String</span>,</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  externalClasses: [<span class="string">&#x27;class&#x27;</span>], <span class="comment">// 可以将 class 设为 externalClasses</span></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<p>这样，可以将 flex 放入自定义组件内：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 页面的 WXML --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">view</span> <span class="attr">style</span>=<span class="string">&quot;display: flex&quot;</span>&gt;</span></span><br><span class="line">  <span class="comment">&lt;!-- 如果设置了 virtualHost ，节点上的样式将失效 --&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">custom-component</span> <span class="attr">style</span>=<span class="string">&quot;color: blue&quot;</span>&gt;</span>不是蓝色的<span class="tag">&lt;/<span class="name">custom-component</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- custom-component.wxml --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">view</span> <span class="attr">style</span>=<span class="string">&quot;flex: 1&quot;</span>&gt;</span></span><br><span class="line">  满宽的</span><br><span class="line">  <span class="tag">&lt;<span class="name">slot</span>&gt;</span><span class="tag">&lt;/<span class="name">slot</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>需要注意的是，自定义组件节点上的 <code>class</code> <code>style</code> 和动画将不再生效，但仍可以：</p>
<ul>
<li>将 style 定义成 <code>properties</code> 属性来获取 style 上设置的值；</li>
<li>将 class 定义成 <code>externalClasses</code> 外部样式类使得自定义组件 wxml 可以使用 class 值。</li>
</ul>
<h3 id="Component-构造器"><a href="#Component-构造器" class="headerlink" title="Component 构造器"></a>Component 构造器</h3><h4 id="1-Component-构造器"><a href="#1-Component-构造器" class="headerlink" title="1.Component 构造器"></a>1.Component 构造器</h4><p>Component<code>构造器可用于定义组件，调用</code>Component` 构造器时可以指定组件的属性、数据、方法等。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line">Component(&#123;</span><br><span class="line"></span><br><span class="line">  behaviors: [],</span><br><span class="line"></span><br><span class="line">  properties: &#123;</span><br><span class="line">    myProperty: &#123; <span class="comment">// 属性名</span></span><br><span class="line">      type: <span class="built_in">String</span>,</span><br><span class="line">      value: <span class="string">&#x27;&#x27;</span></span><br><span class="line">    &#125;,</span><br><span class="line">    myProperty2: <span class="built_in">String</span> <span class="comment">// 简化的定义方式</span></span><br><span class="line">  &#125;,</span><br><span class="line">  </span><br><span class="line">  data: &#123;&#125;, <span class="comment">// 私有数据，可用于模板渲染</span></span><br><span class="line"></span><br><span class="line">  lifetimes: &#123;</span><br><span class="line">    <span class="comment">// 生命周期函数，可以为函数，或一个在methods段中定义的方法名</span></span><br><span class="line">    attached: <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123; &#125;,</span><br><span class="line">    moved: <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123; &#125;,</span><br><span class="line">    detached: <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123; &#125;,</span><br><span class="line">  &#125;,</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 生命周期函数，可以为函数，或一个在methods段中定义的方法名</span></span><br><span class="line">  attached: <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123; &#125;, <span class="comment">// 此处attached的声明会被lifetimes字段中的声明覆盖</span></span><br><span class="line">  ready: <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123; &#125;,</span><br><span class="line"></span><br><span class="line">  pageLifetimes: &#123;</span><br><span class="line">    <span class="comment">// 组件所在页面的生命周期函数</span></span><br><span class="line">    show: <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123; &#125;,</span><br><span class="line">    hide: <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123; &#125;,</span><br><span class="line">    resize: <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123; &#125;,</span><br><span class="line">  &#125;,</span><br><span class="line">    methods: &#123;</span><br><span class="line">    onMyButtonTap: <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">      <span class="built_in">this</span>.setData(&#123;</span><br><span class="line">        <span class="comment">// 更新属性和数据的方法与更新页面数据的方法类似</span></span><br><span class="line">      &#125;)</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="comment">// 内部方法建议以下划线开头</span></span><br><span class="line">    _myPrivateMethod: <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">      <span class="comment">// 这里将 data.A[0].B 设为 &#x27;myPrivateData&#x27;</span></span><br><span class="line">      <span class="built_in">this</span>.setData(&#123;</span><br><span class="line">        <span class="string">&#x27;A[0].B&#x27;</span>: <span class="string">&#x27;myPrivateData&#x27;</span></span><br><span class="line">      &#125;)</span><br><span class="line">    &#125;,</span><br><span class="line">    _propertyChange: <span class="function"><span class="keyword">function</span>(<span class="params">newVal, oldVal</span>) </span>&#123;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<h4 id="2-使用-Component-构造器构造页面"><a href="#2-使用-Component-构造器构造页面" class="headerlink" title="2.使用 Component 构造器构造页面"></a>2.使用 Component 构造器构造页面</h4><p>事实上，小程序的页面也可以视为自定义组件。因而，页面也可以使用 <code>Component</code> 构造器构造，拥有与普通组件一样的定义段与实例方法。但此时要求对应 json 文件中包含 <code>usingComponents</code> 定义段。</p>
<p>此时，组件的属性可以用于接收页面的参数，如访问页面 <code>/pages/index/index?paramA=123&amp;paramB=xyz</code> ，如果声明有属性 <code>paramA</code> 或 <code>paramB</code> ，则它们会被赋值为 <code>123</code> 或 <code>xyz</code> 。</p>
<p>页面的生命周期方法（即 <code>on</code> 开头的方法），应写在 <code>methods</code> 定义段中。</p>
<p><strong>代码示例：</strong></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;usingComponents&quot;</span>: &#123;&#125;</span><br><span class="line">&#125;</span><br><span class="line">Component(&#123;</span><br><span class="line"></span><br><span class="line">  properties: &#123;</span><br><span class="line">    paramA: <span class="built_in">Number</span>,</span><br><span class="line">    paramB: <span class="built_in">String</span>,</span><br><span class="line">  &#125;,</span><br><span class="line"></span><br><span class="line">  methods: &#123;</span><br><span class="line">    onLoad: <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">      <span class="built_in">this</span>.data.paramA <span class="comment">// 页面参数 paramA 的值</span></span><br><span class="line">      <span class="built_in">this</span>.data.paramB <span class="comment">// 页面参数 paramB 的值</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">&#125;)</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>使用 <code>Component</code> 构造器来构造页面的一个好处是可以使用 <code>behaviors</code> 来提取所有页面中公用的代码段。</p>
<p>例如，在所有页面被创建和销毁时都要执行同一段代码，就可以把这段代码提取到 <code>behaviors</code> 中。</p>
<p><strong>代码示例：</strong></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// page-common-behavior.js</span></span><br><span class="line"><span class="built_in">module</span>.exports = Behavior(&#123;</span><br><span class="line">  attached: <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="comment">// 页面创建时执行</span></span><br><span class="line">    <span class="built_in">console</span>.info(<span class="string">&#x27;Page loaded!&#x27;</span>)</span><br><span class="line">  &#125;,</span><br><span class="line">  detached: <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="comment">// 页面销毁时执行</span></span><br><span class="line">    <span class="built_in">console</span>.info(<span class="string">&#x27;Page unloaded!&#x27;</span>)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 页面 A</span></span><br><span class="line"><span class="keyword">var</span> pageCommonBehavior = <span class="built_in">require</span>(<span class="string">&#x27;./page-common-behavior&#x27;</span>)</span><br><span class="line">Component(&#123;</span><br><span class="line">  behaviors: [pageCommonBehavior],</span><br><span class="line">  data: &#123; <span class="comment">/* ... */</span> &#125;,</span><br><span class="line">  methods: &#123; <span class="comment">/* ... */</span> &#125;,</span><br><span class="line">&#125;)</span><br><span class="line"><span class="comment">// 页面 B</span></span><br><span class="line"><span class="keyword">var</span> pageCommonBehavior = <span class="built_in">require</span>(<span class="string">&#x27;./page-common-behavior&#x27;</span>)</span><br><span class="line">Component(&#123;</span><br><span class="line">  behaviors: [pageCommonBehavior],</span><br><span class="line">  data: &#123; <span class="comment">/* ... */</span> &#125;,</span><br><span class="line">  methods: &#123; <span class="comment">/* ... */</span> &#125;,</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<h3 id="组件间通信与事件"><a href="#组件间通信与事件" class="headerlink" title="组件间通信与事件"></a>组件间通信与事件</h3><h4 id="1-组件间通信"><a href="#1-组件间通信" class="headerlink" title="1.组件间通信"></a>1.组件间通信</h4><p>组件间的基本通信方式有以下几种。</p>
<ul>
<li>WXML 数据绑定：用于父组件向子组件的指定属性设置数据，仅能设置 JSON 兼容数据</li>
<li>事件：用于子组件向父组件传递数据，可以传递任意数据。</li>
<li>如果以上两种方式不足以满足需要，父组件还可以通过 <code>this.selectComponent</code> 方法获取子组件实例对象，这样就可以直接访问组件的任意数据和方法。</li>
</ul>
<h5 id="父传子"><a href="#父传子" class="headerlink" title="父传子"></a>父传子</h5><p>与普通的 WXML 模板类似，可以使用数据绑定，这样就可以向子组件的属性传递动态数据。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// components/bill/bill.js 子组件接收父组件传来的值</span></span><br><span class="line">Component(&#123;</span><br><span class="line">    properties: &#123;</span><br><span class="line">        bill: <span class="built_in">Object</span>,</span><br><span class="line">        index: <span class="built_in">Number</span>,</span><br><span class="line">    &#125;</span><br><span class="line">    methods: &#123;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"> &lt;bill bill=<span class="string">&quot;&#123;&#123; billItem &#125;&#125;&quot;</span> index=<span class="string">&quot;&#123;&#123; index &#125;&#125;&quot;</span>/&gt;</span><br></pre></td></tr></table></figure>
<h5 id="子传父"><a href="#子传父" class="headerlink" title="子传父"></a>子传父</h5><p><strong>监听事件</strong></p>
<p><strong>事件系统</strong>是组件间通信的主要方式之一。自定义组件可以触发任意的事件，引用组件的页面可以监听这些事件。</p>
<p>注意：监听自定义组件事件的方法与监听基础组件事件的方法完全一致</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">&lt;!-- 当自定义组件触发“myevent”事件时，调用“onMyEvent”方法 --&gt;</span><br><span class="line">&lt;component-tag-name bindmyevent=<span class="string">&quot;onMyEvent&quot;</span> /&gt;</span><br><span class="line">&lt;!-- 或者可以写成 --&gt;</span><br><span class="line">&lt;component-tag-name bind:myevent=<span class="string">&quot;onMyEvent&quot;</span> /&gt;</span><br><span class="line">Page(&#123;</span><br><span class="line">  onMyEvent: <span class="function"><span class="keyword">function</span>(<span class="params">e</span>)</span>&#123;</span><br><span class="line">    e.detail <span class="comment">// 自定义组件触发事件时提供的detail对象</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p><strong>触发事件</strong></p>
<p>自定义组件触发事件时，需要使用 <code>triggerEvent</code> 方法，指定事件名、detail对象和事件选项：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">&lt;!-- 在自定义组件中 --&gt;</span><br><span class="line">&lt;button bindtap=<span class="string">&quot;onTap&quot;</span>&gt;点击这个按钮将触发“myevent”事件&lt;/button&gt;</span><br><span class="line">Component(&#123;</span><br><span class="line">  properties: &#123;&#125;,</span><br><span class="line">  methods: &#123;</span><br><span class="line">    onTap: <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">      <span class="keyword">var</span> myEventDetail = &#123;&#125; <span class="comment">// detail对象，提供给事件监听函数</span></span><br><span class="line">      <span class="keyword">var</span> myEventOption = &#123;&#125; <span class="comment">// 触发事件的选项</span></span><br><span class="line">      <span class="built_in">this</span>.triggerEvent(<span class="string">&#x27;myevent&#x27;</span>, myEventDetail, myEventOption)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<p>![image-20210122121508698](/Users/weiai/Library/Application Support/typora-user-images/image-20210122121508698.png)</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 页面 page.wxml</span></span><br><span class="line">&lt;another-component bindcustomevent=<span class="string">&quot;pageEventListener1&quot;</span>&gt;</span><br><span class="line">  &lt;my-component bindcustomevent=<span class="string">&quot;pageEventListener2&quot;</span>&gt;&lt;/my-component&gt;</span><br><span class="line">&lt;/another-component&gt;</span><br><span class="line"><span class="comment">// 组件 another-component.wxml</span></span><br><span class="line">&lt;view bindtap=<span class="string">&quot;anotherEventListener&quot;</span>&gt;</span><br><span class="line">  &lt;slot /&gt;</span><br><span class="line">&lt;/view&gt;</span><br><span class="line"><span class="comment">// 组件 my-component.wxml</span></span><br><span class="line">&lt;view bindtap=<span class="string">&quot;myEventListener&quot;</span>&gt;</span><br><span class="line">  &lt;slot /&gt;</span><br><span class="line">&lt;/view&gt;</span><br></pre></td></tr></table></figure>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 组件 my-component.js</span></span><br><span class="line">Component(&#123;</span><br><span class="line">  methods: &#123;</span><br><span class="line">    onTap: <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">      <span class="built_in">this</span>.triggerEvent(<span class="string">&#x27;customevent&#x27;</span>, &#123;&#125;) <span class="comment">// 只会触发 pageEventListener2</span></span><br><span class="line">      <span class="built_in">this</span>.triggerEvent(<span class="string">&#x27;customevent&#x27;</span>, &#123;&#125;, &#123; <span class="attr">bubbles</span>: <span class="literal">true</span> &#125;) <span class="comment">// 会依次触发 pageEventListener2 、 pageEventListener1</span></span><br><span class="line">      <span class="built_in">this</span>.triggerEvent(<span class="string">&#x27;customevent&#x27;</span>, &#123;&#125;, &#123; <span class="attr">bubbles</span>: <span class="literal">true</span>, <span class="attr">composed</span>: <span class="literal">true</span> &#125;) <span class="comment">// 会依次触发 pageEventListener2 、 anotherEventListener 、 pageEventListener1</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<p>这个pageEventListener1的内容岂不是会触发两次</p>
<h4 id="获取组件实例"><a href="#获取组件实例" class="headerlink" title="获取组件实例"></a>获取组件实例</h4><p>可在父组件里调用 <code>this.selectComponent</code> ，获取子组件的实例对象。（插件的自定义组件将返回 <code>null</code>）</p>
<p>在当前页面下选择第一个匹配选择器 <code>selector</code> 的节点。返回一个 <code>NodesRef</code> 对象实例，可以用于获取节点信息。</p>
<p>调用时需要传入一个匹配选择器 <code>selector</code>，如：<code>this.selectComponent(&quot;.my-component&quot;)</code>。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 父组件</span></span><br><span class="line">Page(&#123;</span><br><span class="line">  data: &#123;&#125;,</span><br><span class="line">  getChildComponent: <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">const</span> child = <span class="built_in">this</span>.selectComponent(<span class="string">&#x27;.my-component&#x27;</span>);</span><br><span class="line">    <span class="built_in">console</span>.log(child)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<p>在上例中，父组件将会获取 <code>class</code> 为 <code>my-component</code> 的子组件实例对象，即子组件的 <code>this</code> 。</p>
<h3 id="组件生命周期"><a href="#组件生命周期" class="headerlink" title="组件生命周期"></a>组件生命周期</h3><h4 id="1-组件生命周期"><a href="#1-组件生命周期" class="headerlink" title="1.组件生命周期"></a>1.组件生命周期</h4><p>组件的生命周期，指的是组件自身的一些函数，这些函数在特殊的时间点或遇到一些特殊的框架事件时被自动触发。</p>
<p>其中，最重要的生命周期是 <code>created</code> <code>attached</code> <code>detached</code> ，包含一个组件实例生命流程的最主要时间点。</p>
<ul>
<li>组件实例刚刚被创建好时， <code>created</code> 生命周期被触发。此时，组件数据 <code>this.data</code> 就是在 <code>Component</code> 构造器中定义的数据 <code>data</code> 。 <strong>此时还不能调用 <code>setData</code> 。</strong> 通常情况下，这个生命周期只应该用于给组件 <code>this</code> 添加一些自定义属性字段。</li>
<li>在组件完全初始化完毕、进入页面节点树后， <code>attached</code> 生命周期被触发。此时， <code>this.data</code> 已被初始化为组件的当前值。这个生命周期很有用，绝大多数初始化工作可以在这个时机进行。</li>
<li>在组件离开页面节点树后， <code>detached</code> 生命周期被触发。退出一个页面时，如果组件还在页面节点树中，则 <code>detached</code> 会被触发。</li>
</ul>
<h4 id="2-定义生命周期方法"><a href="#2-定义生命周期方法" class="headerlink" title="2.定义生命周期方法"></a>2.定义生命周期方法</h4><p>组件的的生命周期也可以在 <code>lifetimes</code> 字段内进行声明（这是推荐的方式，其优先级最高）。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">Component(&#123;</span><br><span class="line">  lifetimes: &#123;</span><br><span class="line">    attached: <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">      <span class="comment">// 在组件实例进入页面节点树时执行</span></span><br><span class="line">    &#125;,</span><br><span class="line">    detached: <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">      <span class="comment">// 在组件实例被从页面节点树移除时执行</span></span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="comment">// 以下是旧式的定义方式，可以保持对 &lt;2.2.3 版本基础库的兼容</span></span><br><span class="line">  attached: <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="comment">// 在组件实例进入页面节点树时执行</span></span><br><span class="line">  &#125;,</span><br><span class="line">  detached: <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="comment">// 在组件实例被从页面节点树移除时执行</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<p>![image-20210122152808741](/Users/weiai/Library/Application Support/typora-user-images/image-20210122152808741.png)</p>
<h4 id="3-组件所在页面的生命周期"><a href="#3-组件所在页面的生命周期" class="headerlink" title="3.组件所在页面的生命周期"></a>3.组件所在页面的生命周期</h4><p>还有一些特殊的生命周期，它们并非与组件有很强的关联，但有时组件需要获知，以便组件内部处理。这样的生命周期称为“组件所在页面的生命周期”，在 <code>pageLifetimes</code> 定义段中定义。其中可用的生命周期包括：</p>
<p>![image-20210122153106363](/Users/weiai/Library/Application Support/typora-user-images/image-20210122153106363.png)</p>
<h3 id="behaviors"><a href="#behaviors" class="headerlink" title="behaviors"></a>behaviors</h3><p><code>behaviors</code> 是用于组件间代码共享的特性，类似于一些编程语言中的 “mixins” 或 “traits”。</p>
<p>每个 <code>behavior</code> 可以包含一组属性、数据、生命周期函数和方法。<strong>组件引用它时，它的属性、数据和方法会被合并到组件中，生命周期函数也会在对应时机被调用。</strong> 每个组件可以引用多个 <code>behavior</code> ，<code>behavior</code> 也可以引用其它 <code>behavior</code> 。</p>
<h3 id="组件间关系"><a href="#组件间关系" class="headerlink" title="组件间关系"></a>组件间关系</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;custom-ul&gt;</span><br><span class="line">  &lt;custom-li&gt; item <span class="number">1</span> &lt;/custom-li&gt;</span><br><span class="line">  &lt;custom-li&gt; item <span class="number">2</span> &lt;/custom-li&gt;</span><br><span class="line">&lt;/custom-ul&gt;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>这个例子中， <code>custom-ul</code> 和 <code>custom-li</code> 都是自定义组件，它们有相互间的关系，相互间的通信往往比较复杂。此时在组件定义时加入 <code>relations</code> 定义段，可以解决这样的问题。</p>
<h3 id="数据监听器"><a href="#数据监听器" class="headerlink" title="数据监听器"></a>数据监听器</h3><p>数据监听器可以用于监听和响应任何属性和数据字段的变化。从小程序基础库版本 <a target="_blank" rel="noopener" href="https://developers.weixin.qq.com/miniprogram/dev/framework/compatibility.html">2.6.1</a> 开始支持。</p>
<h4 id="1-使用数据监听器"><a href="#1-使用数据监听器" class="headerlink" title="1.使用数据监听器"></a>1.使用数据监听器</h4><p>有时，在一些数据字段被 setData 设置时，需要执行一些操作。</p>
<p>例如， <code>this.data.sum</code> 永远是 <code>this.data.numberA</code> 与 <code>this.data.numberB</code> 的和。此时，可以使用数据监听器进行如下实现。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">Component(&#123;</span><br><span class="line">  attached: <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="built_in">this</span>.setData(&#123;</span><br><span class="line">      numberA: <span class="number">1</span>,</span><br><span class="line">      numberB: <span class="number">2</span>,</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;,</span><br><span class="line">  observers: &#123;</span><br><span class="line">    <span class="string">&#x27;numberA, numberB&#x27;</span>: <span class="function"><span class="keyword">function</span>(<span class="params">numberA, numberB</span>) </span>&#123;</span><br><span class="line">      <span class="comment">// 在 numberA 或者 numberB 被设置时，执行这个函数</span></span><br><span class="line">      <span class="built_in">this</span>.setData(&#123;</span><br><span class="line">        sum: numberA + numberB</span><br><span class="line">      &#125;)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<h4 id="2-监听字段语法"><a href="#2-监听字段语法" class="headerlink" title="2.监听字段语法"></a>2.监听字段语法</h4><p>数据监听器支持监听属性或内部数据的变化，可以同时监听多个。一次 setData 最多触发每个监听器一次。</p>
<p>同时，监听器可以监听子数据字段，如下例所示。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">Component(&#123;</span><br><span class="line">  observers: &#123;</span><br><span class="line">    <span class="string">&#x27;some.subfield&#x27;</span>: <span class="function"><span class="keyword">function</span>(<span class="params">subfield</span>) </span>&#123;</span><br><span class="line">      <span class="comment">// 使用 setData 设置 this.data.some.subfield 时触发</span></span><br><span class="line">      <span class="comment">// （除此以外，使用 setData 设置 this.data.some 也会触发）</span></span><br><span class="line">      subfield === <span class="built_in">this</span>.data.some.subfield</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="string">&#x27;arr[12]&#x27;</span>: <span class="function"><span class="keyword">function</span>(<span class="params">arr12</span>) </span>&#123;</span><br><span class="line">      <span class="comment">// 使用 setData 设置 this.data.arr[12] 时触发</span></span><br><span class="line">      <span class="comment">// （除此以外，使用 setData 设置 this.data.arr 也会触发）</span></span><br><span class="line">      arr12 === <span class="built_in">this</span>.data.arr[<span class="number">12</span>]</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<p>如果需要监听所有子数据字段的变化，可以使用通配符 <code>**</code> 。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">Component(&#123;</span><br><span class="line">  observers: &#123;</span><br><span class="line">    <span class="string">&#x27;some.field.**&#x27;</span>: <span class="function"><span class="keyword">function</span>(<span class="params">field</span>) </span>&#123;</span><br><span class="line">      <span class="comment">// 使用 setData 设置 this.data.some.field 本身或其下任何子数据字段时触发</span></span><br><span class="line">      <span class="comment">// （除此以外，使用 setData 设置 this.data.some 也会触发）</span></span><br><span class="line">      field === <span class="built_in">this</span>.data.some.field</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;,</span><br><span class="line">  attached: <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="comment">// 这样会触发上面的 observer</span></span><br><span class="line">    <span class="built_in">this</span>.setData(&#123;</span><br><span class="line">      <span class="string">&#x27;some.field&#x27;</span>: &#123; <span class="comment">/* ... */</span> &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">    <span class="comment">// 这样也会触发上面的 observer</span></span><br><span class="line">    <span class="built_in">this</span>.setData(&#123;</span><br><span class="line">      <span class="string">&#x27;some.field.xxx&#x27;</span>: &#123; <span class="comment">/* ... */</span> &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">    <span class="comment">// 这样还是会触发上面的 observer</span></span><br><span class="line">    <span class="built_in">this</span>.setData(&#123;</span><br><span class="line">      <span class="string">&#x27;some&#x27;</span>: &#123; <span class="comment">/* ... */</span> &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<p>特别地，仅使用通配符 <code>**</code> 可以监听全部 setData 。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">Component(&#123;</span><br><span class="line">  observers: &#123;</span><br><span class="line">    &#39;**&#39;: function() &#123;</span><br><span class="line">      &#x2F;&#x2F; 每次 setData 都触发</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<p>注意：</p>
<ul>
<li>数据监听器监听的是 setData 涉及到的数据字段，即使这些数据字段的值没有发生变化，数据监听器依然会被触发。</li>
<li>如果在数据监听器函数中使用 setData 设置本身监听的数据字段，可能会导致死循环，需要特别留意。</li>
<li>数据监听器和属性的 observer 相比，数据监听器更强大且通常具有更好的性能。</li>
</ul>

  </div>
  <div>
    <a href="https://github.com/WeiaiKing/weiaiking.github.io/edit/akingblog/source/_posts/小程序-自定义组件.md"
      target="_blank">编辑</a>
  </div>
</article>


        
          <div id="footer-post-container">
  <div id="footer-post">

    <div id="nav-footer" style="display: none">
      <ul>
         
          <li><a href="/archives/">首页</a></li>
         
          <li><a href="/archives/">关于</a></li>
         
          <li><a href="/archives/">归档</a></li>
         
          <li><a href="/archives">项目</a></li>
        
      </ul>
    </div>

    <div id="toc-footer" style="display: none">
      <ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%B0%8F%E7%A8%8B%E5%BA%8F-%E8%87%AA%E5%AE%9A%E4%B9%89%E7%BB%84%E4%BB%B6"><span class="toc-number">1.</span> <span class="toc-text">小程序-自定义组件</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%BB%84%E4%BB%B6%E6%A8%A1%E6%9D%BF%E5%92%8C%E6%A0%B7%E5%BC%8F"><span class="toc-number">1.1.</span> <span class="toc-text">组件模板和样式</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1-%E7%BB%84%E4%BB%B6%E6%A8%A1%E6%9D%BF"><span class="toc-number">1.1.1.</span> <span class="toc-text">1.组件模板</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-%E7%BB%84%E4%BB%B6wxml%E7%9A%84slot"><span class="toc-number">1.1.2.</span> <span class="toc-text">2.组件wxml的slot</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-%E7%BB%84%E4%BB%B6%E6%A0%B7%E5%BC%8F"><span class="toc-number">1.1.3.</span> <span class="toc-text">3.组件样式</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#4-%E7%BB%84%E4%BB%B6%E6%A0%B7%E5%BC%8F%E9%9A%94%E7%A6%BB"><span class="toc-number">1.1.4.</span> <span class="toc-text">4.组件样式隔离</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%A4%96%E9%83%A8%E6%A0%B7%E5%BC%8F%E7%B1%BB"><span class="toc-number">1.1.5.</span> <span class="toc-text">外部样式类</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#6-%E8%99%9A%E6%8B%9F%E5%8C%96%E7%BB%84%E4%BB%B6%E8%8A%82%E7%82%B9"><span class="toc-number">1.1.6.</span> <span class="toc-text">6. 虚拟化组件节点</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Component-%E6%9E%84%E9%80%A0%E5%99%A8"><span class="toc-number">1.2.</span> <span class="toc-text">Component 构造器</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1-Component-%E6%9E%84%E9%80%A0%E5%99%A8"><span class="toc-number">1.2.1.</span> <span class="toc-text">1.Component 构造器</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-%E4%BD%BF%E7%94%A8-Component-%E6%9E%84%E9%80%A0%E5%99%A8%E6%9E%84%E9%80%A0%E9%A1%B5%E9%9D%A2"><span class="toc-number">1.2.2.</span> <span class="toc-text">2.使用 Component 构造器构造页面</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%BB%84%E4%BB%B6%E9%97%B4%E9%80%9A%E4%BF%A1%E4%B8%8E%E4%BA%8B%E4%BB%B6"><span class="toc-number">1.3.</span> <span class="toc-text">组件间通信与事件</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1-%E7%BB%84%E4%BB%B6%E9%97%B4%E9%80%9A%E4%BF%A1"><span class="toc-number">1.3.1.</span> <span class="toc-text">1.组件间通信</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E7%88%B6%E4%BC%A0%E5%AD%90"><span class="toc-number">1.3.1.1.</span> <span class="toc-text">父传子</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%AD%90%E4%BC%A0%E7%88%B6"><span class="toc-number">1.3.1.2.</span> <span class="toc-text">子传父</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%8E%B7%E5%8F%96%E7%BB%84%E4%BB%B6%E5%AE%9E%E4%BE%8B"><span class="toc-number">1.3.2.</span> <span class="toc-text">获取组件实例</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%BB%84%E4%BB%B6%E7%94%9F%E5%91%BD%E5%91%A8%E6%9C%9F"><span class="toc-number">1.4.</span> <span class="toc-text">组件生命周期</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1-%E7%BB%84%E4%BB%B6%E7%94%9F%E5%91%BD%E5%91%A8%E6%9C%9F"><span class="toc-number">1.4.1.</span> <span class="toc-text">1.组件生命周期</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-%E5%AE%9A%E4%B9%89%E7%94%9F%E5%91%BD%E5%91%A8%E6%9C%9F%E6%96%B9%E6%B3%95"><span class="toc-number">1.4.2.</span> <span class="toc-text">2.定义生命周期方法</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-%E7%BB%84%E4%BB%B6%E6%89%80%E5%9C%A8%E9%A1%B5%E9%9D%A2%E7%9A%84%E7%94%9F%E5%91%BD%E5%91%A8%E6%9C%9F"><span class="toc-number">1.4.3.</span> <span class="toc-text">3.组件所在页面的生命周期</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#behaviors"><span class="toc-number">1.5.</span> <span class="toc-text">behaviors</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%BB%84%E4%BB%B6%E9%97%B4%E5%85%B3%E7%B3%BB"><span class="toc-number">1.6.</span> <span class="toc-text">组件间关系</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%95%B0%E6%8D%AE%E7%9B%91%E5%90%AC%E5%99%A8"><span class="toc-number">1.7.</span> <span class="toc-text">数据监听器</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1-%E4%BD%BF%E7%94%A8%E6%95%B0%E6%8D%AE%E7%9B%91%E5%90%AC%E5%99%A8"><span class="toc-number">1.7.1.</span> <span class="toc-text">1.使用数据监听器</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-%E7%9B%91%E5%90%AC%E5%AD%97%E6%AE%B5%E8%AF%AD%E6%B3%95"><span class="toc-number">1.7.2.</span> <span class="toc-text">2.监听字段语法</span></a></li></ol></li></ol></li></ol>
    </div>

    <div id="share-footer" style="display: none">
      <ul>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.facebook.com/sharer.php?u=http://example.com/2021/02/09/%E5%B0%8F%E7%A8%8B%E5%BA%8F-%E8%87%AA%E5%AE%9A%E4%B9%89%E7%BB%84%E4%BB%B6/"><i class="fab fa-facebook fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://twitter.com/share?url=http://example.com/2021/02/09/%E5%B0%8F%E7%A8%8B%E5%BA%8F-%E8%87%AA%E5%AE%9A%E4%B9%89%E7%BB%84%E4%BB%B6/&text=小程序-自定义组件"><i class="fab fa-twitter fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.linkedin.com/shareArticle?url=http://example.com/2021/02/09/%E5%B0%8F%E7%A8%8B%E5%BA%8F-%E8%87%AA%E5%AE%9A%E4%B9%89%E7%BB%84%E4%BB%B6/&title=小程序-自定义组件"><i class="fab fa-linkedin fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://pinterest.com/pin/create/bookmarklet/?url=http://example.com/2021/02/09/%E5%B0%8F%E7%A8%8B%E5%BA%8F-%E8%87%AA%E5%AE%9A%E4%B9%89%E7%BB%84%E4%BB%B6/&is_video=false&description=小程序-自定义组件"><i class="fab fa-pinterest fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="mailto:?subject=小程序-自定义组件&body=Check out this article: http://example.com/2021/02/09/%E5%B0%8F%E7%A8%8B%E5%BA%8F-%E8%87%AA%E5%AE%9A%E4%B9%89%E7%BB%84%E4%BB%B6/"><i class="fas fa-envelope fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://getpocket.com/save?url=http://example.com/2021/02/09/%E5%B0%8F%E7%A8%8B%E5%BA%8F-%E8%87%AA%E5%AE%9A%E4%B9%89%E7%BB%84%E4%BB%B6/&title=小程序-自定义组件"><i class="fab fa-get-pocket fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://reddit.com/submit?url=http://example.com/2021/02/09/%E5%B0%8F%E7%A8%8B%E5%BA%8F-%E8%87%AA%E5%AE%9A%E4%B9%89%E7%BB%84%E4%BB%B6/&title=小程序-自定义组件"><i class="fab fa-reddit fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.stumbleupon.com/submit?url=http://example.com/2021/02/09/%E5%B0%8F%E7%A8%8B%E5%BA%8F-%E8%87%AA%E5%AE%9A%E4%B9%89%E7%BB%84%E4%BB%B6/&title=小程序-自定义组件"><i class="fab fa-stumbleupon fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://digg.com/submit?url=http://example.com/2021/02/09/%E5%B0%8F%E7%A8%8B%E5%BA%8F-%E8%87%AA%E5%AE%9A%E4%B9%89%E7%BB%84%E4%BB%B6/&title=小程序-自定义组件"><i class="fab fa-digg fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.tumblr.com/share/link?url=http://example.com/2021/02/09/%E5%B0%8F%E7%A8%8B%E5%BA%8F-%E8%87%AA%E5%AE%9A%E4%B9%89%E7%BB%84%E4%BB%B6/&name=小程序-自定义组件&description="><i class="fab fa-tumblr fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://news.ycombinator.com/submitlink?u=http://example.com/2021/02/09/%E5%B0%8F%E7%A8%8B%E5%BA%8F-%E8%87%AA%E5%AE%9A%E4%B9%89%E7%BB%84%E4%BB%B6/&t=小程序-自定义组件"><i class="fab fa-hacker-news fa-lg" aria-hidden="true"></i></a></li>
</ul>

    </div>

    <div id="actions-footer">
        <a id="menu" class="icon" href="#" onclick="$('#nav-footer').toggle();return false;"><i class="fas fa-bars fa-lg" aria-hidden="true"></i> 菜单</a>
        <a id="toc" class="icon" href="#" onclick="$('#toc-footer').toggle();return false;"><i class="fas fa-list fa-lg" aria-hidden="true"></i> 目录</a>
        <a id="share" class="icon" href="#" onclick="$('#share-footer').toggle();return false;"><i class="fas fa-share-alt fa-lg" aria-hidden="true"></i> 分享</a>
        <a id="top" style="display:none" class="icon" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');"><i class="fas fa-chevron-up fa-lg" aria-hidden="true"></i> 返回顶部</a>
    </div>

  </div>
</div>

        
        <footer id="footer">
  <div class="footer-left">
    Copyright &copy;
    
    
    2016-2021
    Aking
  </div>
  <div class="footer-right">
    <nav>
      <ul>
         
          <li><a href="/archives/">首页</a></li>
         
          <li><a href="/archives/">关于</a></li>
         
          <li><a href="/archives/">归档</a></li>
         
          <li><a href="/archives">项目</a></li>
        
      </ul>
    </nav>
  </div>
</footer>

    </div>
    <!-- styles -->

<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">


<link rel="stylesheet" href="/lib/justified-gallery/css/justifiedGallery.min.css">


    <!-- jquery -->

<script src="/lib/jquery/jquery.min.js"></script>


<script src="/lib/justified-gallery/js/jquery.justifiedGallery.min.js"></script>

<!-- clipboard -->

  
<script src="/lib/clipboard/clipboard.min.js"></script>

  <script type="text/javascript">
  $(function() {
    // copy-btn HTML
    var btn = "<span class=\"btn-copy tooltipped tooltipped-sw\" aria-label=\"复制到粘贴板!\">";
    btn += '<i class="far fa-clone"></i>';
    btn += '</span>'; 
    // mount it!
    $(".highlight table").before(btn);
    var clip = new ClipboardJS('.btn-copy', {
      text: function(trigger) {
        return Array.from(trigger.nextElementSibling.querySelectorAll('.code')).reduce((str,it)=>str+it.innerText+'\n','')
      }
    });
    clip.on('success', function(e) {
      e.trigger.setAttribute('aria-label', "复制成功!");
      e.clearSelection();
    })
  })
  </script>


<script src="/js/main.js"></script>

<!-- search -->

<!-- Google Analytics -->

<!-- Baidu Analytics -->

<!-- Cloudflare Analytics -->

<!-- Umami Analytics -->

<!-- Disqus Comments -->


</body>
</html>
